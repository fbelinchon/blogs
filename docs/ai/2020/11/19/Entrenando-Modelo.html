<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    3. ¿Entrenamos? No te preocupes es nuestro modelo de red neuronal el que va a sudar - Mi Blog
    
  </title>
  <!-- Mathjax Support -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
          ]}
        );
      });
    </script>
  
  
  <meta name="description" content="Objetivo">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/blogs/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/blogs/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/blogs/assets/main.css">
  <link rel="canonical" href="https://fbelinchon.github.io/blogs/ai/2020/11/19/Entrenando-Modelo.html">
  <link rel="alternate" type="application/rss+xml" title="Mi Blog" href="/blogs/feed.xml">
  
  

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/blogs/">Mi Blog</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/blogs/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blogs/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blogs/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blogs/AI">AI</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

<header class="masthead" style="background-image: url('/blogs/img/posts/06.jpg')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-md-14 mx-auto">
          <div class="post-heading">
            <h1>3. ¿Entrenamos? No te preocupes es nuestro modelo de red neuronal el que va a sudar</h1>
            
            <h2 class="subheading">Vamos a enseñar a nuestro modelo a realizar una tarea. Cuando aprenda la tendrá que seguir haciendo él solito.</h2>
            
            <span class="meta">Posted by
              <a href="#">Francisco Belinchón</a>
              on November 19, 2020 &middot; <span class="reading-time" title="Estimated read time">
  
   8 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

<div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-14 mx-auto">

        <h1 id="objetivo">Objetivo</h1>

<p>El objetivo de este artículo es explicar de forma sencilla el proceso de entrenamiento de una red neuronal como la descrita en el artículo anterior. Intentaremos evitar las explicaciones matemáticas detalladas, pero si daremos una visión intuitiva del proceso que nos ayude a entenderlo.</p>

<h1 id="intuición-sobre-el-proceso-de-entrenamiento">Intuición sobre el proceso de entrenamiento.</h1>

<p>El concepto del entrenamiento de un modelo de redes neuronales es sencillo y lo hemos mencionado en artículos anteriores. El modelo realiza una predicción sobre los datos de ejemplo que le suministramos y compara la predicción con el valor real que debe proporcionar. El objetivo es que ese error disminuya poco a poco hasta conseguir un modelo con unas predicciones muy cercanas a los valores reales. Para dismuir el error modificamos ligeramente los parámetros de nuestro modelo de forma iterativa.</p>

<p>En los primeros pasos del entrenamiento las predicciones tendrán un error muy grande porque los parámetros del modelo se han seleccionado de modo aleatorio. Por ejemplo, si el modelo intenta predecir si la imagen es de un perro o de un gato la predicción sería como tirar una moneda al aire. Un conjunto aleatorio de parámetros significa que en esos momentos el modelo no sabe nada sobre los datos que tiene que predecir. Según el modelo ajusta los parámetros la tasa de acierto empieza a mejorar. La parte más complicada de este proceso es decidir cuando dejamos de entrenar. Llegado un momento el modelo deja de aprender de los datos de ejemplo y empieza a memorizarlos. Si el modelo empieza a memorizar, realizará predicciones muy exactas sobre los ejemplos de entrenamiento pero las predicciones sobre datos nuevos serán muy inexactas. Posteriormente veremos como detectar ese comportamiento.</p>

<p>La clave del aprendizaje está en ir ajustando los parámetros de forma progresiva para ir disminuyendo el error cometido. El modelo analiza cada parámetro y decide si aumentando o disminuyendo su valor para conseguir el menor error posible.</p>

<h1 id="gradient-descent-como-método-de-aprendizaje-optimización">Gradient Descent como método de aprendizaje (optimización).</h1>

<p>Para decidir si tenemos que aumentar o disminuir los parámetros del modelo recurrimos al concepto de deriva de una función.</p>

<blockquote>
  <p>Derivada de una función en un punto: se puede interpretarse geométricamente como la pendiente de la recta tangente a la gráfica de la función en dicho punto.</p>
</blockquote>

<p>En definitiva la derivada es la pendiente de una curva en un punto. Si lo que buscamos es el mínimo de una función tiene sentido apoyarnos en la pendiente de esa curva para saber si tenemos que aumentar o disminuir ese parámetro.</p>

<p>En el primer ártículo de la serie comparábamos nuestro objetivo de encontrar el mínimo con la búsqueda del camino más rápido para bajar desde el pico de la montaña al valle. En cada paso seleccionábamos la dirección de mayor pendiente para asegurar que bajábamos lo más rápidamente posible.</p>

<p>Nuestro modelo puede tener miles o millones de parámetros con lo que utilizamos lo que se llama derivada parcial de una función con respecto a un parámetro. Esta operación nos devuelve la pendiente de la función en un punto para un parámrtro concreto dejando el resto de parámetros fijos. El cálculo de las derivadas parciales de miles de pármetros es una operación muy costosa y en muchos casos inviable. En la práctica utilizamos una aproximación que se denomina <em>Gradient Descent</em>.</p>

<h2 id="stochastic-gradiente-descent-sgd">Stochastic Gradiente descent SGD.</h2>
<p>Para calcular el gradiente en un punto estudiamos como se comporta la función a su alrededor. De esta forma obtenemos valores similares a la deriva parcial de forma menos costosa. Si tenemos el valor de la función en un punto y el valor cuando nos movemos un poco podemos estimar el valor de pendiente en ese punto. No es el valor exacto pero es una buena aproximación para saber si tenemos que aumentar o disminuir el valor de nuestro parámetro para aproximarnos al mínimo de la función de coste.</p>

<p>El método más popular que se utiliza en el entrenamiento de redes neuronales se llama Stochastic Gradient Descent o simplemente SGD. Es un proceso iterativo que calcula el gradiente de un grupo de ejemplos y con esa información actualiza los parámetros el modelo. Vamos a detallar el proceso utilizando la nomneclatura propia asociada a redes neuronales.</p>

<h3 id="fases-del-proceso-de-optimización-utilizando-sgd">Fases del proceso de optimización utilizando SGD</h3>
<p>Nuestro conjunto de entrenamiento se divide en pequeños subconjuntos denominados batch o mini-batch. La selección de que ejemplos entran en cada batch se suele hacer de forma aleatoria. El núemro de elementos de cada batch se define inicialmente y es el mismmo para todos excepto para el último que tendrá el número de ejemplo que queden.</p>

<p>Pongamos un ejemplo. Si tenemos un conjunto de ejemplos con 1000 elementos y utilizamos un tamaño de batch igual a 64 tendríamos.</p>
<ul>
  <li>15 batches con 64 elementos.</li>
  <li>1 batch final con 40 elementos que son los que quedan.</li>
</ul>

<p>Para entrenar el modelo vamos pasando uno por uno nuestros 16 grupos o batches. Por cada batch el modelo calcula la salida, la compara con el resultado que debería producirse y actualiza los parámetros para que la función de error se más pequeña.
Es importante entender que para un batch solamente hay una actualización de los parámetros. No se produce una modificación de los parámetros por cada uno de los 64 ejemplo sino que se realiza una estimación para el conjunto total de los 64 ejemplos. En estudios realizados se ha demostrado que el cáculo del gradiente de esta forma nos permite aproximarnos al mínimo e una forma más rápida y más consistente que el hecho de calcular el gradiente individual de cada ejemplo.</p>

<p>Cuando hemos completado un ciclo entero, en este caso los 16 batches definidos, el modelo ha recibido todos los jemplos de nuestro conjunto de entrenamiento. Esto no es suficiente y lo normal es volver a repetir el proceso completo varias veces para ir ajustando el modelo. Cada vez que utilizamos todos los ejemplos de entrenamiento en nuestro modelo se denomina <em>epoch</em>. Si decimos que vamos a entrenar un modelo durante 20 epochs significa que vamos a realizar el proceso de dividir en batches de forma aleatorio todos los datos y mostrarlos al modelo 20 veces seguidas.</p>

<h3 id="learning-rate-ratio-de-aprendizaje">Learning rate (ratio de aprendizaje)</h3>

<p>Proceso bacth</p>

<h2 id="underfiting-vs-overfitting">Underfiting vs Overfitting</h2>

<h2 id="fases-de-proceso-de-aprendizaje">Fases de proceso de aprendizaje.</h2>
<ul>
  <li>Toma de contacto.
    <ul>
      <li>Inicialización de parámetros.</li>
    </ul>
  </li>
  <li>Aprendizaje</li>
  <li>Memorización</li>
</ul>

<h1 id="preparación-de-los-datos">Preparación de los datos</h1>
<h2 id="conjunto-de-entrenamiento-validación-y-test">Conjunto de entrenamiento, validación y test.</h2>
<ul>
  <li>Conjunto de entrenamiento vs conjunto de validación.</li>
  <li>Conjunto de test</li>
</ul>

<h1 id="flujo-del-proceso-de-entrenamiento">Flujo del proceso de entrenamiento.</h1>
<ul>
  <li>blucle por epoch
    <ul>
      <li>Bucle por batch
        <ul>
          <li>Training</li>
          <li>Validación</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Análisis de resultados entrenamiento vs validación.</p>

<h1 id="conclusiones">Conclusiones</h1>

<p>Método de optimización. 
Proceso iterativo.
Prueba con diferentes hiperparámetros.
Ajustes.</p>

<p>Objetivo -&gt; modelo entrenado</p>


        <hr />

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/blogs/2020/11/09/foco.html" data-toggle="tooltip" data-placement="top" title="¿Quieres saber como mejorar tus procesos, focaliza tu esfuerzo?">&larr; Anteriores<span class="d-none d-md-inline">
              Post</span></a>
          
          

        </div>

      </div>
    </div>
  </div>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:fbelinchon@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/fbelinchonm">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://www.facebook.com/fbelinchon@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://www.linkedin.com/in/francisco-belinchon">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://github.com/fbelinchon">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; Francisco Belinchón 2020</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/blogs/assets/vendor/jquery/jquery.min.js"></script>
<script src="/blogs/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/blogs/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/blogs/assets/scripts.js"></script>





  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-183869372-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-183869372-1');
</script>



</body>

</html>
